<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/n.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/n32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/n16x16.png">
  <link rel="mask-icon" href="/images/n.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="为什么要重构项目在不断演进过程中，代码不停在堆砌。如果没有人为代码质量负责，代码总是会往越来越混乱的方向演进。当混乱到一定程度之后，量变引起质变，项目的维护成本已经高过重新开放一套新代码的成本，想要再去重构，已经没有人能做到了。">
<meta property="og:type" content="article">
<meta property="og:title" content="重构">
<meta property="og:url" content="http://example.com/2024/04/02/%E9%87%8D%E6%9E%84/index.html">
<meta property="og:site_name" content="删除のN方式">
<meta property="og:description" content="为什么要重构项目在不断演进过程中，代码不停在堆砌。如果没有人为代码质量负责，代码总是会往越来越混乱的方向演进。当混乱到一定程度之后，量变引起质变，项目的维护成本已经高过重新开放一套新代码的成本，想要再去重构，已经没有人能做到了。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-04-02T06:39:37.000Z">
<meta property="article:modified_time" content="2024-04-02T08:18:58.753Z">
<meta property="article:author" content="Deleteuser">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2024/04/02/%E9%87%8D%E6%9E%84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>重构 | 删除のN方式</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">删除のN方式</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-hdd fa-fw"></i>资源</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/02/%E9%87%8D%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Deleteuser">
      <meta itemprop="description" content="美好生活从遇到问题直接删除开始">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="删除のN方式">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          重构
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-02 14:39:37 / 修改时间：16:18:58" itemprop="dateCreated datePublished" datetime="2024-04-02T14:39:37+08:00">2024-04-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="为什么要重构"><a href="#为什么要重构" class="headerlink" title="为什么要重构"></a>为什么要重构</h3><p>项目在不断演进过程中，代码不停在堆砌。如果没有人为代码质量负责，代码总是会往越来越混乱的方向演进。当混乱到一定程度之后，量变引起质变，项目的维护成本已经高过重新开放一套新代码的成本，想要再去重构，已经没有人能做到了。 <span id="more"></span></p>
<p>造成这样的原因往往有以下几点：</p>
<ol>
<li>代码之前缺乏有效设计</li>
<li>成本上的考虑，在原功能堆砌式编程</li>
<li>缺乏有效代码质量监督机制</li>
</ol>
<p>对于此类问题，业界已有很好的解决思路：通过持续不断的重构将代码中的坏味道清除掉。</p>
<h3 id="什么是重构"><a href="#什么是重构" class="headerlink" title="什么是重构"></a>什么是重构</h3><p>重构一书中的作则Martin Fowler对重构的定义：</p>
<blockquote>
<p>重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。重构（动词）：使用一系列重构手法，在不改变软件观察行为的前提下，调整其结构。</p>
</blockquote>
<p>根据重构的规模可以大致分为大型重构和小型重构：</p>
<p><strong>大型重构</strong>：对顶层代码设计的重构，包括系统、模块、代码结构、类与类之间的关系等的重构，重构的手段有：分层、模块化、解耦、抽象可复用组件等等。这类重构的工具就是我们学校过的那些设计思想、原则和模式。这类重构涉及的代码改动会比较多，影响面会比较大，所以难度也较大，耗时会比较长，引入bug的风险也会相对比较大。</p>
<p><strong>小型重构</strong>：对代码细节的重构，主要针对类、函数、变量等代码级别的重构，比如规范命名和注释、消除超大类或函数、提取重复代码等等。小型重构更多的是使用统一的编码规范。这类重构要修改的地方比较集中，比较简单，可操作性较强，耗时会比较短，引入bug的风险相对来说也会比较小。</p>
<h3 id="代码的坏味道"><a href="#代码的坏味道" class="headerlink" title="代码的坏味道"></a>代码的坏味道</h3><p><strong>代码重复</strong></p>
<ul>
<li>实现逻辑相同、执行流程相同</li>
</ul>
<p><strong>方法过长</strong></p>
<ul>
<li>方法中的语句不在同一个抽象层级</li>
<li>逻辑难以理解，需要大量的注释</li>
<li>面向过程编程而非面向对象</li>
</ul>
<p><strong>过大的类</strong></p>
<ul>
<li>类做了太多事情</li>
<li>包含过多的实例变量和方法</li>
<li>类的命名不足以描述所做的事情</li>
</ul>
<p><strong>逻辑分散</strong></p>
<ul>
<li>发散式变化：某个类经常因为不同的原因在不通过的方向上发生变化</li>
<li>散弹式修改你：发生某种变化是，需要在多个类中做修改</li>
</ul>
<p><strong>严重的情节依恋</strong></p>
<ul>
<li>某个类的方法过多的使用其他类的成员</li>
</ul>
<p><strong>数据泥团&#x2F;基本类型偏执</strong></p>
<ul>
<li>两个类、方法签名中包含相同的字段或参数</li>
<li>应该使用类但使用基本类型，比如表示数值与币种的Money类、起始值与结束值的Range类</li>
</ul>
<p><strong>不合理的继承体系</strong></p>
<ul>
<li>继承打破了封装性，子类依赖父类中特定功能的实现细节</li>
<li>子类必须跟着其父类的更新而演变，除非父类是专门为了扩展而设计，并且有很好的文档说明</li>
</ul>
<p><strong>过多的条件判断</strong></p>
<p><strong>过长的参数列</strong></p>
<p><strong>临时变量过多</strong></p>
<p><strong>令人迷惑的暂时字段</strong></p>
<ul>
<li>某个实例变量仅为某种特定情况而设置</li>
<li>将实例变量与对应的方法提取到新的类中</li>
</ul>
<p><strong>纯数据类</strong></p>
<ul>
<li>仅包含字段和访问（读写）这些字段的方法</li>
<li>此类被称为数据容器，应保持最小可变性</li>
</ul>
<p><strong>不恰当的命名</strong></p>
<ul>
<li>命名无法准确描述做的事情</li>
<li>命名不符合约定俗成的惯例</li>
</ul>
<p><strong>过多的注释</strong></p>
<h3 id="坏代码的问题"><a href="#坏代码的问题" class="headerlink" title="坏代码的问题"></a>坏代码的问题</h3><ul>
<li><strong>难以复用</strong></li>
<li>系统关联性过多，导致很难分离可重用部分</li>
<li><strong>难于变化</strong></li>
<li>一处变化导致气筒很多部分的修改，不利于系统稳定</li>
<li><strong>难以理解</strong></li>
<li>命名杂乱，结构混乱，难以阅读和理解</li>
<li><strong>难以测试</strong></li>
<li>分支、依赖较多，难以覆盖全面</li>
</ul>
<h3 id="什么是好代码"><a href="#什么是好代码" class="headerlink" title="什么是好代码"></a>什么是好代码</h3><p>代码质量的评价有很强的主观性，描述代码质量的词汇也有很多，比如可读性、可维护性、灵活、优雅、简洁。这些词汇是从不同的维度去评价代码质量的。其中，可维护性、可读性、可扩展性又是提到最多的、最重要的三个评价标准。</p>
<p>要写出高质量代码，我们就需要掌握一些更加细化、更加能落地的编程方法论，这就包含面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。</p>
<h3 id="如何重构"><a href="#如何重构" class="headerlink" title="如何重构"></a>如何重构</h3><p><strong>SOLID原则</strong></p>
<p>在程序设计领域，SOLID（单一功能、开闭原则、里氏替换、接口隔离以及依赖反转）指代了面向对象编程和面向对象设计的五个基本原则。当这些原则被一起应用时，它们使得一个程序员开发一个容易进行软件维护和扩展的系统变得更加可能。</p>
<p><strong>单一职责原则</strong></p>
<p>一个类只负责完成一个职责或者功能，不要存在多于一种导致类变更的原因。</p>
<p>单一职责原则通过避免设计大而全的类，避免将不相关的功能耦合在一起，来提高类的内聚性。同时，类职责单一，类依赖的和被依赖的其他类也会变少，减少了代码的耦合性，以此来实现代码的高内聚，松耦合。但是，如果拆分得过细，实际上会适得其反，反倒会减低内聚性，也会影响代码的可维护性。</p>
<p><strong>开放-关闭原则</strong></p>
<p>添加一个新功能，应该是通过已有代码基础上扩展代码（新增模块、类、方法、属性等），而非修改已有代码（修改模块、类、方法、属性等）的方式来完成。</p>
<p>开闭原则并不是说完全杜绝修改，而是以最小的修改代码的代价来完成新功能的开发。</p>
<p>很多设计原则、设计思想、设计模式，都是以提高代码的扩展性为最终目的。特别是<strong>23种经典设计模式</strong>，大部分都是为了解决代码的扩展性问题而总结出来的，都是以开闭原则为指导原则的。最常用来提高代码扩展性的方法有：多态、依赖注入、基于接口而非实现编程，以及大部分的设计模式（比如，装饰、策略、模板、职责链、状态）。</p>
<p><strong>里氏替换原则</strong></p>
<p>子类对象（object of subtype&#x2F;derived class）能够替换程序（program）中父类对象（object of base&#x2F;parent class）出现的任何地方，并且保证原来程序的逻辑行为（behavior）不变及正确性不被破坏。</p>
<p>子类可以扩展父类的功能，但不能改父类原有的功能</p>
<blockquote>
<p>父类中凡是已经实现好的方法（相对于抽象方法而言），实际上是在设定一系列的规范和契约，虽然它不强制要求所有的子类必须遵从这些契约，但如果子类对这些非抽象方法任意修改，就会对整个继承体系造成破坏。</p>
</blockquote>
<p><strong>接口隔离原则</strong></p>
<p>调用方不应该依赖它不需要的接口；一个类对另一个类的依赖因建立在最小的接口上。接口隔离原则提供了一种判断接口的职责是否单一的标准：通过调用者如何使用接口来间接地判定。如果调用者只使用部分接口或接口的部分功能，那接口Dev设计就不够职责单一。</p>
<p><strong>依赖反转原则</strong></p>
<p>高层模块不应该依赖底层模块，二者都应该依赖其抽象；抽象不应该依赖细节，细节应该依赖抽象。</p>
<p><strong>迪米特法则</strong></p>
<p>一个对象应该对其他对象保持最少的了解。</p>
<p><strong>合成复用原则</strong></p>
<p>尽量使用合成、聚合的方式，而不是使用继承。</p>
<p>单一职责原则告诉我们实现类要职责单一；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合。而开闭原则是总纲，告诉我们要对扩展开放，对修改关闭。</p>
<p><strong>设计模式</strong></p>
<blockquote>
<p>设计模式：软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的实验和错误总结出来的。每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案。</p>
</blockquote>
<ul>
<li>创建型：主要解决对象的创建问题，封装复杂的创建过程，解耦对象的创建代码和使用代码。</li>
<li>结构型：主要通过类或对象的不同组合，解耦不同功能的耦合</li>
<li>行为型：主要解决的是类或对象之间的交互行为的耦合 。</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>模式</th>
<th>说明</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>创建型</td>
<td>单例</td>
<td>一个类只允许创建一个实例或对象，并为其提供一个全局的访问点</td>
<td>无状态&#x2F;q全局唯一&#x2F;控制资源访问</td>
</tr>
<tr>
<td></td>
<td>工厂</td>
<td>创建一个或者多个相关的对象，而使用者不用关心具体的实现类</td>
<td>分离对象的创建和使用</td>
</tr>
<tr>
<td></td>
<td>建造者</td>
<td>用于创建一种类型的复杂对象，通过设置不同的可选参数进行“定制化”</td>
<td>对象的构造参数较多且多数可选</td>
</tr>
<tr>
<td></td>
<td>原型</td>
<td>通过复制已有对象来创建新的对象</td>
<td>对象的创建成本较多且多数可选</td>
</tr>
<tr>
<td>结构型</td>
<td>代理</td>
<td>不改变原始类和不使用继承的情况下，通过引入代理类来给原始类附加功能</td>
<td>增加代理访问，比如监控、缓存、限流、事务、RPC</td>
</tr>
<tr>
<td></td>
<td>装饰者</td>
<td>不改变原始类和不使用继承的情况下，通过组合的方式动态扩展原始类的功能</td>
<td>动态扩展类的功能</td>
</tr>
<tr>
<td></td>
<td>适配器</td>
<td>不改变原始类的情况下，通过组合的方式使其适配新的接口</td>
<td>复用现有类，但与期望接口不适配</td>
</tr>
<tr>
<td></td>
<td>桥接</td>
<td>当类存在多个独立变化的维度时，通过组合的方式使得其可以独立进行扩展</td>
<td>存在多个维度的继承体系</td>
</tr>
<tr>
<td></td>
<td>门面</td>
<td>为子系统中一组接口定义一个更高层的接口，使得子系统更加容易使用</td>
<td>解决接口复用性（细粒度）与接口易用性（粗粒度）的矛盾</td>
</tr>
<tr>
<td></td>
<td>组合</td>
<td>将对象组合成树形结构以表示部分-整体的层次结构，统一单个对和组合对象的处理逻辑</td>
<td>满足部分与整体这种树形结构</td>
</tr>
<tr>
<td></td>
<td>享元</td>
<td>运用共享技术有效地支持大量细粒度的对象</td>
<td>当系统存在大量的对象，这些对象的很多字段取值范围固定</td>
</tr>
<tr>
<td>行为型</td>
<td>观察者</td>
<td>多个观察这监听同一主题对象，当主题对象状态发生变化时通知所有观察这，使它们能够自动更新自己</td>
<td>解耦事件创建者与接受者</td>
</tr>
<tr>
<td></td>
<td>模板</td>
<td>定义一个操作中算法的骨架，将某些步骤实现延迟到子类中</td>
<td>解决复用和扩展问题</td>
</tr>
<tr>
<td></td>
<td>策略</td>
<td>定义一组算法类，将每个算法分别封装起来，使得它们可以互相替换</td>
<td>消除各种if-else分支判断，解耦策略的定义、创造</td>
</tr>
<tr>
<td></td>
<td>状态</td>
<td>允许第一个对象在其内部状态改变的时候改变其行为</td>
<td>分离对象的状态与行为</td>
</tr>
<tr>
<td></td>
<td>职责链</td>
<td>将一组对象连城一条链，请求沿着该链传递，直到某个对象能够处理它为止</td>
<td>解耦集合对象的内部表示与遍历访问</td>
</tr>
<tr>
<td></td>
<td>迭代器</td>
<td>封装一些作用于某种数据结构中个元素的操作，在不改变数据结构的前提下，定义作用于这些元素的新操作</td>
<td>分离对象的数据结构与行为</td>
</tr>
<tr>
<td></td>
<td>访问者</td>
<td>封装一些作用于某种数据结构中个元素的操作，在不改变数据结构的前提下，定义作用于这些元素的新操作</td>
<td>分离对象的数据结构与行为</td>
</tr>
<tr>
<td></td>
<td>备忘录</td>
<td>在不违背封装原则的前提下，捕获一个对象的内部状态，以便之后恢复对象为先前的状态</td>
<td>用于对象的备份与恢复</td>
</tr>
<tr>
<td></td>
<td>命令</td>
<td>将不同的请求分装成对应的命令对象，对命令的执行进行控制且对使用方透明</td>
<td>用于控制命令的执行，比如异步、延迟、排队、撤销、存储与撤销</td>
</tr>
<tr>
<td></td>
<td>解释器</td>
<td>为某种语言定义它的语法表示，并定义一个解释器来处理这个语法</td>
<td>用于编译器、规则引擎、正则表达式等特定场景</td>
</tr>
<tr>
<td></td>
<td>中介</td>
<td>定义一个单独的中介对象，来封装一组对象之间的交互，避免对象之间的直接交互</td>
<td>使各个对象不需要显式地相互引用，从而使其耦合松散</td>
</tr>
</tbody></table>
<p><strong>代码分层</strong></p>
<p><strong>模块结构说明</strong></p>
<ul>
<li>server_main:配置层，负责整个项目的module的module管理，maven配置管理、资源管理等；</li>
<li>server_application:应用接入层，承接外部流量入口，例如：RPC接口实现、消息处理、定时任务等；不要在此包含业务逻辑；</li>
<li>server_biz:核心业务层，用例服务、领域实体、领域事件等。</li>
<li>server_irepository:资源接口层，负责资源接口的暴露</li>
<li>server_repository:资源层，负责资源的proxy访问，统一外部资源访问，隔离变化。注意：这里强调的是弱业务性，强数据性；</li>
<li>server_common:公共层，vo、工具等</li>
</ul>
<p>代码开发要遵守各层的规范，并注意层级之间的依赖关系。</p>
<p><strong>命名规范</strong></p>
<blockquote>
<p>一个好的命名应该要满足以下两个约束</p>
</blockquote>
<ul>
<li>准确描述锁做得事情</li>
<li>格式符合通用的惯例</li>
</ul>
<p>如果你觉得一个类或方法难以命名的时候，可能是其承载的功能太多了，需要进一步拆分。</p>
<p><strong>约定俗成的惯例</strong></p>
<table>
<thead>
<tr>
<th>场景</th>
<th>强约束</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>项目名</td>
<td>全部小写，多个单词用中划线分隔“-”</td>
<td>spring-cloud</td>
</tr>
<tr>
<td>包名</td>
<td>全部小写</td>
<td>com.alibaba.fastjson</td>
</tr>
<tr>
<td>类名&#x2F;接口名</td>
<td>单词首字母大写</td>
<td>ParserConfig.DefaultFieldDeserializer</td>
</tr>
<tr>
<td>变量名</td>
<td>首字母小写，多个单词组成是，除首个单词，其他单词首字母都要大写</td>
<td>passWord,userName</td>
</tr>
<tr>
<td>常量名</td>
<td>全部大写，多个单词，用“_”分隔</td>
<td>CACHE_EXPIRED_TIME</td>
</tr>
<tr>
<td>方法</td>
<td>同变量</td>
<td>ready()</td>
</tr>
</tbody></table>
<p><strong>类命名</strong></p>
<blockquote>
<p>类名使用大驼峰命名形式，类命通常使用名词或名词短语。接口名除了用名词和名词短语以外，还可以使用形容词或形容词短语，如Cloneable，Callable等，表示实现该接口的类有某种功能或能力。</p>
</blockquote>
<table>
<thead>
<tr>
<th>场景</th>
<th>约束</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>抽象类</td>
<td>Abstract或者Base开头</td>
<td>BaseUserService</td>
</tr>
<tr>
<td>枚举类</td>
<td>Enum作为后缀</td>
<td>GenderEnum</td>
</tr>
<tr>
<td>工具类</td>
<td>Utils作为后缀</td>
<td>StringUtils</td>
</tr>
<tr>
<td>异常类</td>
<td>Exception结尾</td>
<td>RuntimeException</td>
</tr>
<tr>
<td>接口实现类</td>
<td>接口名+impl</td>
<td>UserServiceImpl</td>
</tr>
<tr>
<td>设计模式相关类</td>
<td>Builder，Factory等</td>
<td>当使用设计模式时，需要使用对应的设计模式作为后缀，如ThreadFactory</td>
</tr>
<tr>
<td>处理特定功能的类</td>
<td>Handler，Predicate，Validator</td>
<td>表示处理器，校验器，断言，这些类工厂还有配套的方法名。如handle，predicate，validate</td>
</tr>
<tr>
<td>特定层级的类</td>
<td>Controller,Service,ServiceImpl,Dao后缀</td>
<td>UserController,UserServiceImpl,UserDao</td>
</tr>
<tr>
<td>特定层级的值对象</td>
<td>AO,Param,Vo,Config,Message</td>
<td>Param调用入参;Ao为thrift返回结果;Vo通用值对象;Config配置类,Message为MQ消息</td>
</tr>
<tr>
<td>测试类</td>
<td>Test结尾</td>
<td>UserServiceTest,表示用来测试UserService相关业务的测试类</td>
</tr>
</tbody></table>
<p><strong>方法命名</strong></p>
<blockquote>
<p>方法命名采用小驼峰的形式，首字小写，往后的每个单词首字母都要大写。和类名不同的是，方法命名一般为动画或动画短语，与参数或参数名共同组成动宾短语，即动词+名词。一个好的函数名一般能通过名字直接获知函数实现什么样的功能。</p>
</blockquote>
<table>
<thead>
<tr>
<th>场景</th>
<th>约束</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>返回真伪值</td>
<td>is&#x2F;can&#x2F;has&#x2F;needs&#x2F;should</td>
<td>isVaild&#x2F;canRemove</td>
</tr>
<tr>
<td>用于检查</td>
<td>ensure&#x2F;vaildate</td>
<td>ensureCapacity&#x2F;vaildateInputs</td>
</tr>
<tr>
<td>按需执行</td>
<td>ifNeeder&#x2F;try&#x2F;OrDefault&#x2F;OrElse</td>
<td>drawIfNeeded&#x2F;tryCreate&#x2F;getOrDefault</td>
</tr>
<tr>
<td>数据相关</td>
<td>get&#x2F;search&#x2F;save&#x2F;update&#x2F;batchSave&#x2F;batchUpdate&#x2F;saveOrUpdateselect&#x2F;insert&#x2F;update&#x2F;delete</td>
<td>getUserById&#x2F;searchUsersByCreateTime</td>
</tr>
<tr>
<td>生命周期</td>
<td>initialize&#x2F;pause&#x2F;stop&#x2F;destroy</td>
<td>initailze&#x2F;pause&#x2F;onPause&#x2F;stop&#x2F;onStop</td>
</tr>
<tr>
<td>常用动词对</td>
<td>split&#x2F;join、inject&#x2F;extract、bind&#x2F;seperate、increase&#x2F;decrease、lanch&#x2F;run、observe&#x2F;listen、build&#x2F;publish、encode&#x2F;decode、submit&#x2F;commit、push&#x2F;pull、enter&#x2F;exit、expand&#x2F;collapse、encode&#x2F;decode</td>
<td></td>
</tr>
</tbody></table>
<p><strong>重构技巧</strong></p>
<p><strong>提炼方法</strong></p>
<p>多个方法代码重复、方法中代码过程或者方法中语句不在一个抽象层级。方法是代码复用的最小粒度，方法过长不利于复用，可读性低，提炼方法往往是重构工作的第一步。</p>
<p><strong>意图导向编程</strong>：把处理某件事的流程和具体做事的实现方式分开。</p>
<ul>
<li>把一个问题分解为一系列功能性步骤，并假定这些功能步骤以实现</li>
<li>我们只需把各个函数组织在一起即可解决这一问题</li>
<li>在组织好整个功能后，我们在分别实现各个方法函数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">  * 1、交易信息开始于一串标准ASCII字符串。 </span></span><br><span class="line"><span class="comment">  * 2、这个信息字符串必须转换成一个字符串的数组，数组存放的此次交易的领域语言中所包含的词汇元素（token)。 </span></span><br><span class="line"><span class="comment">  * 3、每一个词汇必须标准化。 </span></span><br><span class="line"><span class="comment">  * 4、包含超过150个词汇元素的交易，应该采用不同于小型交易的方式（不同的算法）来提交，以提高效率。 </span></span><br><span class="line"><span class="comment">  * 5、如果提交成功，API返回”true”；失败，则返回”false”。 </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transaction</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">commit</span><span class="params">(String command)</span>&#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        String[] tokens = tokenize(command);</span><br><span class="line">        normalizeToken(tokens);</span><br><span class="line">        <span class="keyword">if</span>(isALargeTransaction(tokens))&#123;</span><br><span class="line">            result = processSmallTransaction(tokens);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            result = processSmallTransaction(tokens);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>以函数对象取代函数</strong></p>
<p>将函数放进一个单独对象中，如此一来局部变量就编程利对象内的字段。然后你可以再用一个对象中将这个大型函数分解为多个小型函数。</p>
<p><strong>引入参数对象</strong></p>
<p>方法参数比较多时，将参数封装为参数对象</p>
<p><strong>移除对参数的赋值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">discount</span><span class="params">(<span class="type">int</span> inputVal, <span class="type">int</span> quantity, <span class="type">int</span> yearToDate)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (inputVal &gt; <span class="number">50</span>) inputVal -= <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (quantity &gt; <span class="number">100</span>) inputVal -= <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (yearToDate &gt; <span class="number">10000</span>) inputVal -= <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">return</span> inputVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">discount</span><span class="params">(<span class="type">int</span> inputVal, <span class="type">int</span> quantity, <span class="type">int</span> yearToDate)</span> &#123; </span><br><span class="line">  <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> inputVal;</span><br><span class="line">  <span class="keyword">if</span> (inputVal &gt; <span class="number">50</span>) result -= <span class="number">2</span>; </span><br><span class="line">  <span class="keyword">if</span> (quantity &gt; <span class="number">100</span>) result -= <span class="number">1</span>; </span><br><span class="line">  <span class="keyword">if</span> (yearToDate &gt; <span class="number">10000</span>) result -= <span class="number">4</span>; </span><br><span class="line">  <span class="keyword">return</span> result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>将查询与修改分离</strong></p>
<p>任何有返回值得方法，都不应该有副作用</p>
<ul>
<li>不要在convert中写操作，避免副作用</li>
<li>常见的例外：将查询结构缓存到本地</li>
</ul>
<p><strong>移除不必要临时变量</strong></p>
<p>临时变脸仅适用一次或者取值逻辑成本很低的情况下</p>
<p><strong>引入解释性变量</strong></p>
<p>将复杂表达式（或其中一部分）的结果放进一个临时变量，以此变量名称来解释表达式用途</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((platform.toUpperCase().indexOf(<span class="string">&quot;MAC&quot;</span>) &gt; -<span class="number">1</span>) </span><br><span class="line">    &amp;&amp; (browser.toUpperCase().indexOf(<span class="string">&quot;IE&quot;</span>) &gt; -<span class="number">1</span>) &amp;&amp; wasInitialized() &amp;&amp; resize &gt; <span class="number">0</span>) &#123;   </span><br><span class="line">  <span class="comment">// do something </span></span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">isMacOs</span> <span class="operator">=</span> platform.toUpperCase().indexOf(<span class="string">&quot;MAC&quot;</span>) &gt; -<span class="number">1</span>; </span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">isIEBrowser</span> <span class="operator">=</span> browser.toUpperCase().indexOf(<span class="string">&quot;IE&quot;</span>) &gt; -<span class="number">1</span>; </span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">wasResized</span> <span class="operator">=</span> resize &gt; <span class="number">0</span>; </span><br><span class="line"><span class="keyword">if</span> (isMacOs &amp;&amp; isIEBrowser &amp;&amp; wasInitialized() &amp;&amp; wasResized) &#123;   </span><br><span class="line">  <span class="comment">// do something </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用卫语句替代嵌套条件判断</strong></p>
<p>把复杂的条件表达式拆分成多个表达式，减少嵌套。嵌套了好几层的if-then-else语句，转换为多个if语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//未使用卫语句</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getHello</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setHello();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//使用卫语句</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getHello</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用多态替代条件判断</strong></p>
<p>当存在这样一类表达式，它根据对象类型的不同选择不同的行为。可以将这种表达式的每个分支放进一个子类内的复写函数中，然后将原始函数声明为抽象函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public int calculate(int a, int b, String operator) &#123;</span><br><span class="line">    int result = Integer.MIN_VALUE;</span><br><span class="line"> </span><br><span class="line">    if (&quot;add&quot;.equals(operator)) &#123;</span><br><span class="line">        result = a + b;</span><br><span class="line">    &#125; else if (&quot;multiply&quot;.equals(operator)) &#123;</span><br><span class="line">        result = a * b;</span><br><span class="line">    &#125; else if (&quot;divide&quot;.equals(operator)) &#123;</span><br><span class="line">        result = a / b;</span><br><span class="line">    &#125; else if (&quot;subtract&quot;.equals(operator)) &#123;</span><br><span class="line">        result = a - b;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当出现大量类型检查和判断时，if else（或switch）语句的体积会比较臃肿，这无疑降低了代码的可读性。另外，if else(或switch)本身就是一个“变化点”，当需要扩展新的类型时，我们不得不追加if else（或switch）语句块，以及相应的逻辑，这无疑降低了程序的可扩展性，也违反了面向对象的开闭原则。</p>
<blockquote>
<p>基于这种场景，我们可以考虑使用“多态”来代替冗长的条件判断。将if else（或switch）中的“变化点”封装到子类中。这样，就不需要使用if else（或switch）语句了，取而代之的是子类多态的实例，从而提高代码的可读性和可扩展性。很多设计模式使用都是这种套路，比如策略模式、状态模式。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Operation</span> &#123; </span><br><span class="line">  <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Addition</span> <span class="keyword">implements</span> <span class="title class_">Operation</span> &#123; </span><br><span class="line">  <span class="meta">@Override</span> </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> a + b; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperatorFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Map&lt;String, Operation&gt; operationMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        operationMap.put(<span class="string">&quot;add&quot;</span>, <span class="keyword">new</span> <span class="title class_">Addition</span>());</span><br><span class="line">        operationMap.put(<span class="string">&quot;divide&quot;</span>, <span class="keyword">new</span> <span class="title class_">Division</span>());</span><br><span class="line">        <span class="comment">// more operators</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Operation <span class="title function_">getOperation</span><span class="params">(String operator)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> operationMap.get(operator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, String operator)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (OperatorFactory .getOperation == <span class="literal">null</span>) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid Operator&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OperatorFactory .getOperation(operator).apply(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用异常替代返回错误码</strong></p>
<p>非正常业务状态，使用抛出异常的方式代替返回错误码</p>
<ul>
<li><p>不要使用异常处理用于正常的业务流程控制</p>
<ul>
<li>异常处理的性能成本非常高</li>
</ul>
</li>
<li><p>尽量使用标准异常</p>
</li>
<li><p>避免在finally语句块中抛出异常</p>
<ul>
<li>如果同时抛出两个异常，则第一个异常的调用栈会丢失</li>
<li>finally块中应只做关闭资源这类的事情</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用错误码</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">withdraw</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (balance &lt; amount) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        balance -= amount;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (amount &gt; balance) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;amount too large&quot;</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">    balance -= amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>引入断言</strong></p>
<p>某一段代码需要对程序状态做出某种假设，以断言明确表现这种假设。</p>
<ul>
<li>不要滥用断言，不要使用它来检查“应该为真”的条件，只使用它来检查“一定必须为真”的条件</li>
<li>如果断言所指示的约束条件不能满足，代码是否能正常运行？如果可以就去掉断言</li>
</ul>
<p><strong>引入Null对象或特殊对象</strong></p>
<p>当使用一个方法返回的对象时，而这个对象可能为空，这个时候需要对这个对象进行操作前，需要进行判空，否则就会报空指针。当这种判断频繁的出现在各处代码之中，就会影响代码的美观程度和可读性，甚至增加Bug的几率。</p>
<p>空引用的问题的Java中无法避免，但可以通过代码编程技巧（引入空对象）来改善这一问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空对象的例子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperatorFactory</span> &#123; </span><br><span class="line">  <span class="keyword">static</span> Map&lt;String, Operation&gt; operationMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); </span><br><span class="line">  <span class="keyword">static</span> &#123; </span><br><span class="line">    operationMap.put(<span class="string">&quot;add&quot;</span>, <span class="keyword">new</span> <span class="title class_">Addition</span>()); </span><br><span class="line">    operationMap.put(<span class="string">&quot;divide&quot;</span>, <span class="keyword">new</span> <span class="title class_">Division</span>()); </span><br><span class="line">    <span class="comment">// more operators </span></span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;Operation&gt; <span class="title function_">getOperation</span><span class="params">(String operator)</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(operationMap.get(operator)); </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, String operator)</span> &#123; </span><br><span class="line">  <span class="type">Operation</span> <span class="variable">targetOperation</span> <span class="operator">=</span> OperatorFactory.getOperation(operator) </span><br><span class="line">     .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid Operator&quot;</span>)); </span><br><span class="line">  <span class="keyword">return</span> targetOperation.apply(a, b); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊对象的例子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvalidOp</span> <span class="keyword">implements</span> <span class="title class_">Operation</span> &#123; </span><br><span class="line">  <span class="meta">@Override</span> </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>  &#123; </span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid Operator&quot;</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/04/02/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" rel="prev" title="线程安全">
      <i class="fa fa-chevron-left"></i> 线程安全
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%87%8D%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">为什么要重构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%87%8D%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">什么是重构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93"><span class="nav-number">3.</span> <span class="nav-text">代码的坏味道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%8F%E4%BB%A3%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">坏代码的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A5%BD%E4%BB%A3%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">什么是好代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%87%8D%E6%9E%84"><span class="nav-number">6.</span> <span class="nav-text">如何重构</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Deleteuser"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Deleteuser</p>
  <div class="site-description" itemprop="description">美好生活从遇到问题直接删除开始</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024-04 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Deleteuser</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
